<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikZ SVG Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .svg-container {
            border: 2px solid #e0e0e0;
            padding: 20px;
            margin: 10px 0;
            background: white;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .info {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ¨ TikZ SVG Rendering Tests</h1>
    
    <!-- Test 1: Raw SVG from dvisvgm -->
    <div class="test-container">
        <h2>Test 1: Raw SVG (paste from backend log)</h2>
        <div class="info">ViewBox: <span id="viewbox-1">N/A</span></div>
        <div class="info">Width x Height: <span id="size-1">N/A</span></div>
        <div class="svg-container" id="svg-1">
            <!-- Paste SVG here -->
            <p style="color: #999;">Paste SVG content in the script below</p>
        </div>
        <pre id="code-1"></pre>
    </div>

    <!-- Test 2: Normalized SVG (after frontend processing) -->
    <div class="test-container">
        <h2>Test 2: Normalized SVG (viewBox starts at 0,0)</h2>
        <div class="info">ViewBox: <span id="viewbox-2">N/A</span></div>
        <div class="svg-container" id="svg-2">
            <!-- Normalized SVG will be injected here -->
        </div>
        <pre id="code-2"></pre>
    </div>

    <!-- Test 3: Scaled SVG -->
    <div class="test-container">
        <h2>Test 3: Scaled SVG (preserveAspectRatio)</h2>
        <div class="info">ViewBox: <span id="viewbox-3">N/A</span></div>
        <div class="svg-container" id="svg-3">
            <!-- Scaled SVG will be injected here -->
        </div>
        <pre id="code-3"></pre>
    </div>

    <script>
        // SVG with Ghostscript (correct rendering)
        const rawSvg = String.raw`<?xml version='1.0' encoding='UTF-8'?>
<!-- This file was generated by dvisvgm 3.4.3 -->
<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='192.669712pt' height='126.968795pt' viewBox='-66.687096 -66.688388 192.669712 126.968795'>
<defs>
<clipPath id='clip1'>
<path d='M 71 38 L 183 38 L 183 60 L 71 60 Z M 71 38 '/>
</clipPath>
</defs>
<g id='page1'>
<g clip-path='url(#clip1)' clip-rule='nonzero'>
<path fill='none' stroke-width='0.99626' stroke-linecap='butt' stroke-miterlimit='10' stroke='rgb(0%, 0%, 0%)' stroke-opacity='1' d='M 0.000875 0.00125 L 142.253125 0.00125 L 53.316656 88.937719 Z M 0.000875 0.00125 ' transform='matrix(1, 0, 0, -1, 71.187, 49.039)'/>
</g>
<g fill='rgb(0%, 0%, 0%)' fill-opacity='1'>
<use x='67.691' y='59.738' xlink:href='#g0-65'/>
</g>
<g fill='rgb(0%, 0%, 0%)' fill-opacity='1'>
<use x='211.639' y='59.738' xlink:href='#g0-66'/>
</g>
<g fill='rgb(0%, 0%, 0%)' fill-opacity='1'>
<use x='118.607' y='-49.263' xlink:href='#g0-67'/>
</g>
</g>
</svg>`;

        // Test 1: Display raw SVG
        function test1() {
            const container = document.getElementById('svg-1');
            container.innerHTML = rawSvg;
            
            const svg = container.querySelector('svg');
            if (svg) {
                document.getElementById('viewbox-1').textContent = svg.getAttribute('viewBox');
                document.getElementById('size-1').textContent = `${svg.getAttribute('width')} x ${svg.getAttribute('height')}`;
            }
            document.getElementById('code-1').textContent = rawSvg.substring(0, 500) + '...';
        }

        // Test 2: Normalize SVG (like frontend does)
        function test2() {
            let processedSvg = rawSvg;
            
            // Remove width/height
            processedSvg = processedSvg.replace(/\s+width=['"][^'"]*['"]/g, '');
            processedSvg = processedSvg.replace(/\s+height=['"][^'"]*['"]/g, '');
            
            // Normalize viewBox
            const viewBoxMatch = processedSvg.match(/viewBox=['"]([^'"]+)['"]/);
            if (viewBoxMatch) {
                const [minX, minY, width, height] = viewBoxMatch[1].split(/\s+/).map(Number);
                processedSvg = processedSvg.replace(
                    viewBoxMatch[0],
                    `viewBox="0 0 ${width} ${height}"`
                );
                
                // Add transform to first group
                processedSvg = processedSvg.replace(
                    /<g id=['"]page1['"]/,
                    `<g id="page1" transform="translate(${-minX}, ${-minY})"`
                );
            }
            
            const container = document.getElementById('svg-2');
            container.innerHTML = processedSvg;
            
            const svg = container.querySelector('svg');
            if (svg) {
                document.getElementById('viewbox-2').textContent = svg.getAttribute('viewBox');
            }
            document.getElementById('code-2').textContent = processedSvg.substring(0, 500) + '...';
        }

        // Test 3: Add preserveAspectRatio
        function test3() {
            let processedSvg = rawSvg;
            
            // Remove width/height
            processedSvg = processedSvg.replace(/\s+width=['"][^'"]*['"]/g, '');
            processedSvg = processedSvg.replace(/\s+height=['"][^'"]*['"]/g, '');
            
            // Normalize viewBox
            const viewBoxMatch = processedSvg.match(/viewBox=['"]([^'"]+)['"]/);
            if (viewBoxMatch) {
                const [minX, minY, width, height] = viewBoxMatch[1].split(/\s+/).map(Number);
                processedSvg = processedSvg.replace(
                    viewBoxMatch[0],
                    `viewBox="0 0 ${width} ${height}" preserveAspectRatio="xMidYMid meet" style="max-width: 400px; height: auto;"`
                );
                
                // Add transform
                processedSvg = processedSvg.replace(
                    /<g id=['"]page1['"]/,
                    `<g id="page1" transform="translate(${-minX}, ${-minY})"`
                );
            }
            
            const container = document.getElementById('svg-3');
            container.innerHTML = processedSvg;
            
            const svg = container.querySelector('svg');
            if (svg) {
                document.getElementById('viewbox-3').textContent = svg.getAttribute('viewBox');
            }
            document.getElementById('code-3').textContent = processedSvg.substring(0, 500) + '...';
        }

        // Run all tests
        test1();
        test2();
        test3();
    </script>
</body>
</html>
